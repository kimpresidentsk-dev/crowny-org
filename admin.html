<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CROWNY ADMIN</title>
    <link rel="stylesheet" href="style.css?v=21.2">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.7.1/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.7.1/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.7.1/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.7.1/firebase-storage-compat.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAqrMOtOCVTMqzsVEJgAMq5SBrpUzgABS8",
            authDomain: "crowny-84b84.firebaseapp.com",
            projectId: "crowny-84b84",
            storageBucket: "crowny-84b84.firebasestorage.app",
            messagingSenderId: "482020243607",
            appId: "1:482020243607:web:8b60558c7af507f4bed1d2"
        };
        firebase.initializeApp(firebaseConfig);
        window.auth = firebase.auth();
        window.db = firebase.firestore();
        window.OFFCHAIN_RATE = 100;
        window.OFFCHAIN_TOKENS = {
            CRTD: { name: '크라우니 트레이딩 달러', icon: '📈', color: '#FF6D00' },
            CRAC: { name: '크라우니 아트 크레딧', icon: '🎭', color: '#E91E63' },
            CRGC: { name: '크라우니 굿즈 & 기빙', icon: '🛒', color: '#00BFA5' },
            CREB: { name: '크라우니 에코 바이오', icon: '🌱', color: '#2E7D32' }
        };
        window.THIRDWEB_CONFIG = { clientId: '26c044bdfa2f575538d00945419126bf', contracts: { CRNY: '0xe56173b6a57680286253566B9C80Fcc175c88bE1', FNC: '0x68E3aA1049F583C2f1701fefc4443e398ebF32ee', CRFN: '0x396DAd0C7625a4881cA0cd444Cd80A9bbce4A054' } };
    </script>
    <style>
        .admin-layout { display:flex; min-height:100vh; }
        .admin-sidebar { width:220px; background:#1a1a2e; color:white; padding:1rem 0; position:fixed; height:100vh; overflow-y:auto; }
        .admin-sidebar .logo { padding:1rem 1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); margin-bottom:1rem; }
        .admin-sidebar .logo h1 { font-size:1.2rem; letter-spacing:2px; color:#FFD700; }
        .admin-sidebar .logo p { font-size:0.75rem; color:rgba(255,255,255,0.5); }
        .admin-sidebar .nav-link { display:block; padding:0.7rem 1.5rem; color:rgba(255,255,255,0.7); text-decoration:none; font-size:0.85rem; transition:all 0.2s; }
        .admin-sidebar .nav-link:hover { background:rgba(255,255,255,0.1); color:white; }
        .admin-sidebar .nav-link.active { background:rgba(255,255,255,0.15); color:#FFD700; border-left:3px solid #FFD700; }
        .admin-main { margin-left:220px; padding:1.5rem; flex:1; background:var(--bg); min-height:100vh; }
        @media(max-width:768px) {
            .admin-sidebar { width:100%; height:auto; position:relative; }
            .admin-main { margin-left:0; }
            .admin-layout { flex-direction:column; }
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <div class="logo">
                <h1>🔐 CROWNY</h1>
                <p>ADMIN PANEL</p>
            </div>
            <a href="index.html" class="nav-link">← 메인으로</a>
            <div id="admin-sidebar-nav"></div>
            <div style="padding:1rem 1.5rem; border-top:1px solid rgba(255,255,255,0.1); margin-top:1rem;">
                <p id="admin-user-email" style="font-size:0.75rem; color:rgba(255,255,255,0.5);"></p>
                <button onclick="auth.signOut();location.href='index.html'" style="margin-top:0.5rem;background:rgba(255,255,255,0.1);color:white;border:none;padding:0.4rem 0.8rem;border-radius:6px;cursor:pointer;font-size:0.8rem;width:100%;">로그아웃</button>
            </div>
        </aside>
        <main class="admin-main">
            <div id="admin-loading" style="text-align:center;padding:3rem;color:var(--accent);">로딩 중...</div>
            <div id="admin-content" style="display:none;">
<div id="admin-not-authorized" style="text-align:center; padding:2rem; color:var(--accent);">
                관리자 권한이 필요합니다.
            </div>
            
            <div id="admin-panel" style="display:none;">
                <!-- 관리자 레벨 표시 -->
                <div id="admin-level-badge" style="text-align:center; padding:0.8rem; background:#1a1a2e; color:white; border-radius:8px; margin-bottom:1rem; font-size:0.9rem;"></div>
                
                <!-- ★ 관리자 탭 메뉴 -->
                <div id="admin-tab-bar" style="display:flex; gap:4px; overflow-x:auto; padding:4px; background:#f0f0f0; border-radius:10px; margin-bottom:1rem;">
                    <!-- JS에서 권한별 탭 동적 생성 -->
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB 1: 🔥 오프체인 포인트 관리 (레벨 2+)   -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-offchain" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">🔥 오프체인 포인트 관리</h3>
                        <p style="font-size:0.75rem; color:var(--accent); margin-bottom:1rem;">Firebase DB · Zero-Gas · 100 pt = 1 CRNY</p>
                        
                        <!-- 유저 잔액 조회 -->
                        <div style="background:#e3f2fd; padding:1rem; border-radius:8px; margin-bottom:1rem;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.5rem;">🔍 유저 오프체인 잔액 조회</h4>
                            <div style="display:flex; gap:0.5rem; align-items:end;">
                                <input type="email" id="admin-off-lookup-email" placeholder="user@email.com" style="flex:1; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                <button onclick="adminLookupOffchain()" style="background:#1565c0; color:white; border:none; padding:0.5rem 1rem; border-radius:4px; cursor:pointer; white-space:nowrap;">조회</button>
                            </div>
                            <div id="admin-off-lookup-result" style="margin-top:0.5rem; font-size:0.85rem;"></div>
                        </div>
                        
                        <!-- 포인트 발행 (민팅) — 수퍼관리자 전용 -->
                        <div id="admin-mint-section" style="background:#e8f5e9; padding:1rem; border-radius:8px; margin-bottom:1rem;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.5rem;">📈 포인트 발행 (민팅)</h4>
                            <div style="display:grid; grid-template-columns:1fr 1fr 1fr auto; gap:0.5rem; align-items:end;">
                                <div>
                                    <label style="font-size:0.7rem;">이메일</label>
                                    <input type="email" id="admin-off-mint-email" placeholder="user@email.com" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                                <div>
                                    <label style="font-size:0.7rem;">토큰</label>
                                    <select id="admin-off-mint-token" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                        <option value="crtd">📈 CRTD</option>
                                        <option value="crac">🎭 CRAC</option>
                                        <option value="crgc">🛒 CRGC</option>
                                        <option value="creb">🌱 CREB</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="font-size:0.7rem;">수량</label>
                                    <input type="number" id="admin-off-mint-amount" value="100" min="1" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                                <button onclick="adminMintOffchain()" style="background:#2e7d32; color:white; border:none; padding:0.5rem 1rem; border-radius:4px; cursor:pointer;">발행</button>
                            </div>
                            <div>
                                <label style="font-size:0.7rem;">사유</label>
                                <input type="text" id="admin-off-mint-reason" placeholder="이벤트 보상, 프로모션 등" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px; margin-top:0.3rem; box-sizing:border-box;">
                            </div>
                        </div>
                        
                        <!-- 포인트 차감 (소각) — 수퍼관리자 전용 -->
                        <div id="admin-burn-section" style="background:#fce4ec; padding:1rem; border-radius:8px; margin-bottom:1rem;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.5rem;">📉 포인트 차감 (소각)</h4>
                            <div style="display:grid; grid-template-columns:1fr 1fr 1fr auto; gap:0.5rem; align-items:end;">
                                <div>
                                    <label style="font-size:0.7rem;">이메일</label>
                                    <input type="email" id="admin-off-burn-email" placeholder="user@email.com" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                                <div>
                                    <label style="font-size:0.7rem;">토큰</label>
                                    <select id="admin-off-burn-token" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                        <option value="crtd">📈 CRTD</option>
                                        <option value="crac">🎭 CRAC</option>
                                        <option value="crgc">🛒 CRGC</option>
                                        <option value="creb">🌱 CREB</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="font-size:0.7rem;">수량</label>
                                    <input type="number" id="admin-off-burn-amount" value="100" min="1" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                                <button onclick="adminBurnOffchain()" style="background:#c62828; color:white; border:none; padding:0.5rem 1rem; border-radius:4px; cursor:pointer;">차감</button>
                            </div>
                            <div>
                                <label style="font-size:0.7rem;">사유</label>
                                <input type="text" id="admin-off-burn-reason" placeholder="패널티, 환불 등" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px; margin-top:0.3rem; box-sizing:border-box;">
                            </div>
                        </div>

                        <!-- ★ 토큰 관리 (수퍼관리자 전용) -->
                        <div id="admin-token-mgmt-section" style="background:linear-gradient(135deg,#fff8e1,#fff3e0); padding:1rem; border-radius:8px; margin-bottom:1rem; border:1px solid #ffcc80;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.6rem;">🪙 오프체인 토큰 관리</h4>
                            
                            <!-- 등록된 토큰 목록 -->
                            <div id="admin-token-list" style="margin-bottom:0.8rem;"></div>
                            
                            <!-- 새 토큰 생성 -->
                            <details style="margin-top:0.5rem;">
                                <summary style="cursor:pointer; font-size:0.82rem; font-weight:600; color:#E65100;">➕ 새 토큰 생성</summary>
                                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:0.4rem; margin-top:0.5rem;">
                                    <div>
                                        <label style="font-size:0.68rem;">KEY (영문소문자)</label>
                                        <input type="text" id="new-token-key" placeholder="예: crpt" maxlength="10" style="width:100%; padding:0.4rem; border:1px solid var(--border); border-radius:4px; font-size:0.82rem;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.68rem;">이름 (대문자)</label>
                                        <input type="text" id="new-token-name" placeholder="예: CRPT" maxlength="10" style="width:100%; padding:0.4rem; border:1px solid var(--border); border-radius:4px; font-size:0.82rem;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.68rem;">설명</label>
                                        <input type="text" id="new-token-fullname" placeholder="예: 프라이빗 토큰" style="width:100%; padding:0.4rem; border:1px solid var(--border); border-radius:4px; font-size:0.82rem;">
                                    </div>
                                </div>
                                <div style="display:grid; grid-template-columns:auto 1fr auto; gap:0.4rem; margin-top:0.4rem; align-items:end;">
                                    <div>
                                        <label style="font-size:0.68rem;">아이콘</label>
                                        <input type="text" id="new-token-icon" value="🪙" maxlength="2" style="width:40px; padding:0.4rem; border:1px solid var(--border); border-radius:4px; text-align:center; font-size:1.1rem;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.68rem;">색상</label>
                                        <input type="color" id="new-token-color" value="#FF6D00" style="width:100%; height:32px; border:1px solid var(--border); border-radius:4px; cursor:pointer;">
                                    </div>
                                    <button onclick="createCustomToken()" style="background:#E65100; color:white; border:none; padding:0.5rem 1rem; border-radius:4px; cursor:pointer; font-weight:600; font-size:0.82rem;">🪙 생성</button>
                                </div>
                            </details>
                        </div>
                        
                        <!-- ★ 일괄 배포 (수퍼관리자 전용) -->
                        <div id="admin-dist-section" style="background:linear-gradient(135deg,#e8eaf6,#e3f2fd); padding:1rem; border-radius:8px; margin-bottom:1rem; border:1px solid #90caf9;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.6rem;">📦 토큰 일괄 배포</h4>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.4rem;">
                                <div>
                                    <label style="font-size:0.7rem;">토큰</label>
                                    <select id="admin-dist-token" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                        <option value="crtd">📈 CRTD</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="font-size:0.7rem;">1인당 수량</label>
                                    <input type="number" id="admin-dist-amount" value="100" min="1" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                            </div>
                            <div style="margin-top:0.4rem;">
                                <label style="font-size:0.7rem;">사유</label>
                                <input type="text" id="admin-dist-reason" placeholder="이벤트 보상, 프로모션 등" style="width:100%; padding:0.4rem; border:1px solid var(--border); border-radius:4px; box-sizing:border-box;">
                            </div>
                            <div style="margin-top:0.4rem;">
                                <label style="font-size:0.7rem;">대상 이메일 (줄바꿈/쉼표 구분)</label>
                                <textarea id="admin-dist-emails" rows="4" placeholder="user1@email.com&#10;user2@email.com&#10;user3@email.com" style="width:100%; padding:0.4rem; border:1px solid var(--border); border-radius:4px; font-size:0.8rem; resize:vertical; box-sizing:border-box;"></textarea>
                            </div>
                            <div style="display:flex; gap:0.4rem; margin-top:0.5rem;">
                                <button onclick="adminBatchDistribute()" style="flex:1; background:#1565C0; color:white; border:none; padding:0.5rem; border-radius:4px; cursor:pointer; font-weight:600; font-size:0.82rem;">📦 선택 배포</button>
                                <button onclick="adminDistributeToAll()" style="flex:0.6; background:#7B1FA2; color:white; border:none; padding:0.5rem; border-radius:4px; cursor:pointer; font-weight:600; font-size:0.82rem;">🌐 전체 배포</button>
                            </div>
                            <div id="admin-dist-result" style="margin-top:0.5rem;"></div>
                        </div>

                        <!-- 최근 오프체인 거래 내역 -->
                        <div style="background:var(--bg); padding:1rem; border-radius:8px;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.5rem;">📜 최근 오프체인 거래 내역</h4>
                            <button onclick="adminLoadOffchainTxLog()" style="background:#455a64; color:white; border:none; padding:0.4rem 0.8rem; border-radius:4px; cursor:pointer; font-size:0.8rem; margin-bottom:0.5rem;">🔄 새로고침</button>
                            <div id="admin-off-tx-log" style="max-height:300px; overflow-y:auto;"></div>
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB 2: 💰 온체인 지갑 (레벨 4+)           -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-wallet" class="admin-tab-content" style="display:none;">
                    <!-- 삭제된 지갑 조회 -->
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
                            <h3 style="margin:0;">🗑️ 삭제된 지갑</h3>
                            <button onclick="adminLoadDeletedWallets()" style="background:#c62828;color:white;border:none;padding:0.4rem 0.8rem;border-radius:6px;cursor:pointer;font-size:0.8rem;">🔍 조회</button>
                        </div>
                        <div id="admin-deleted-wallets"><p style="font-size:0.85rem;color:#999;">조회 버튼을 눌러주세요</p></div>
                    </div>
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">💰 온체인 지갑 관리</h3>
                        <div id="admin-wallet-info" style="margin-bottom:1rem;">
                            <button onclick="loadAdminWallet()" class="btn-primary" style="margin-bottom:0.5rem;">🔄 지갑 새로고침</button>
                        </div>
                        <div style="background:var(--bg); padding:1rem; border-radius:8px; margin-bottom:1rem;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.5rem;">📤 토큰 보내기 (온체인 Polygon)</h4>
                            <div style="display:grid; grid-template-columns:1fr 1fr 1fr auto; gap:0.5rem; align-items:end;">
                                <div>
                                    <label style="font-size:0.75rem;">받는 사람 이메일</label>
                                    <input type="email" id="admin-send-email" placeholder="user@email.com" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                                <div>
                                    <label style="font-size:0.75rem;">토큰</label>
                                    <select id="admin-send-token" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                        <option value="crny">CRNY</option>
                                        <option value="fnc">FNC</option>
                                        <option value="crfn">CRFN</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="font-size:0.75rem;">수량</label>
                                    <input type="number" id="admin-send-amount" value="1" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                                <button onclick="adminSendToken()" style="background:#0066cc; color:white; border:none; padding:0.5rem 1rem; border-radius:4px; cursor:pointer; white-space:nowrap;">보내기</button>
                            </div>
                            <p style="font-size:0.7rem; color:var(--accent); margin-top:0.5rem;">⚠️ Polygon 온체인 전송 — POL(MATIC) 가스비 필요</p>
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB 3: 📊 챌린지 관리 (레벨 3+)           -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-challenge" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">📊 챌린지 참가자 관리</h3>
                        <button onclick="loadAdminParticipants()" class="btn-primary" style="margin-bottom:1rem;">🔄 참가자 목록 새로고침</button>
                        <div id="admin-participants-list"></div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB 4: 👥 회원 관리 (레벨 6)              -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-users" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">👥 관리자 계층 관리</h3>
                        <!-- 권한 매트릭스 -->
                        <div style="background:#f3e5f5; padding:1rem; border-radius:8px; margin-bottom:1rem;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.5rem;">📋 계층 권한표</h4>
                            <div style="font-size:0.75rem; line-height:1.8;">
                                <div>👑 <strong>Lv6 수퍼</strong>: 토큰 발행/차감 + 쿼터 설정 + Lv5 임명</div>
                                <div>🌍 <strong>Lv5 국가</strong>: 온·오프체인 + 챌린지 + Lv4 임명</div>
                                <div>💼 <strong>Lv4 사업</strong>: 온·오프체인 + 챌린지 + Lv3 임명</div>
                                <div>🔧 <strong>Lv3 서비스</strong>: 오프체인(조회) + 챌린지 + Lv2 임명</div>
                                <div>📝 <strong>Lv2 운영</strong>: 오프체인(조회) 전용</div>
                                <div>💬 <strong>Lv1 CS</strong>: 읽기 전용</div>
                            </div>
                        </div>
                        <button onclick="loadAdminUserList()" class="btn-primary" style="margin-bottom:0.5rem;">🔄 관리자 현황</button>
                        <div id="admin-user-list"></div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB 5: 🎁 기부풀 관리 (레벨 3+)           -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-giving" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">🎁 기부풀 관리 (CRGC)</h3>
                        <button onclick="adminLoadGivingPool()" class="btn-primary" style="margin-bottom:1rem;">🔄 기부풀 현황</button>
                        <div id="admin-giving-pool-info" style="background:#e8f5e9; padding:1rem; border-radius:8px; margin-bottom:1rem;"></div>
                        <div>
                            <h4 style="font-size:0.85rem; margin-bottom:0.5rem;">🎯 기부풀 분배</h4>
                            <div style="display:flex; gap:0.5rem; align-items:end;">
                                <div style="flex:1;">
                                    <label style="font-size:0.7rem;">받는 사람 이메일</label>
                                    <input type="email" id="admin-giving-email" placeholder="user@email.com" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                                <div>
                                    <label style="font-size:0.7rem;">수량 (CRGC pt)</label>
                                    <input type="number" id="admin-giving-amount" value="100" min="1" style="width:100%; padding:0.5rem; border:1px solid var(--border); border-radius:4px;">
                                </div>
                                <button onclick="adminDistributeGivingPool()" style="background:#00897b; color:white; border:none; padding:0.5rem 1rem; border-radius:4px; cursor:pointer;">분배</button>
                            </div>
                        </div>
                        <div style="margin-top:1rem;">
                            <h4 style="font-size:0.85rem; margin-bottom:0.5rem;">📜 기부풀 로그</h4>
                            <div id="admin-giving-log" style="max-height:250px; overflow-y:auto;"></div>
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB: ⭐ 소개자 보상 설정 (수퍼관리자)      -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-referral" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">⭐ 소개자 보상 설정</h3>
                        <p style="font-size:0.85rem; color:var(--accent); margin-bottom:1rem;">회원가입 시 소개자에게 지급되는 오프체인 토큰 수치를 설정합니다.</p>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.8rem; margin-bottom:1rem;">
                            <div>
                                <label style="font-size:0.8rem; font-weight:600;">📈 CRTD</label>
                                <input type="number" id="referral-cfg-crtd" value="30" min="0" max="10000" style="width:100%; padding:0.5rem; border:1px solid #ddd; border-radius:6px;">
                            </div>
                            <div>
                                <label style="font-size:0.8rem; font-weight:600;">🎭 CRAC</label>
                                <input type="number" id="referral-cfg-crac" value="20" min="0" max="10000" style="width:100%; padding:0.5rem; border:1px solid #ddd; border-radius:6px;">
                            </div>
                            <div>
                                <label style="font-size:0.8rem; font-weight:600;">🛒 CRGC</label>
                                <input type="number" id="referral-cfg-crgc" value="30" min="0" max="10000" style="width:100%; padding:0.5rem; border:1px solid #ddd; border-radius:6px;">
                            </div>
                            <div>
                                <label style="font-size:0.8rem; font-weight:600;">🌱 CREB</label>
                                <input type="number" id="referral-cfg-creb" value="20" min="0" max="10000" style="width:100%; padding:0.5rem; border:1px solid #ddd; border-radius:6px;">
                            </div>
                        </div>
                        <button onclick="saveReferralRewardConfig()" class="btn-primary" style="width:100%; padding:0.7rem;">💾 보상 수치 저장</button>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB 6.5: ⚖️ 비율 관리 (수퍼관리자)         -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-rate" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">⚖️ 오프체인/CRNY 교환 비율</h3>
                        <p style="font-size:0.85rem; color:#666; margin-bottom:1rem;">
                            토큰별로 개별 비율을 설정할 수 있습니다.<br>
                            변경 시 2단계 확인이 필요하며, 모든 변경은 로그에 기록됩니다.
                        </p>
                        
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.8rem; margin-bottom:1.5rem;">
                            <div style="background:linear-gradient(135deg,#fff3e0,#ffe0b2); padding:1rem; border-radius:10px; border:1px solid #ffcc80;">
                                <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem;">
                                    <span style="font-size:1.2rem;">📈</span>
                                    <strong style="font-size:0.9rem;">CRTD</strong>
                                    <span style="font-size:0.7rem; color:#e65100;">트레이딩</span>
                                </div>
                                <div style="display:flex; gap:0.4rem; align-items:center;">
                                    <input type="number" id="rate-crtd" value="100" min="1" max="10000" style="flex:1; padding:0.6rem; border:1px solid #ffcc80; border-radius:6px; font-size:1rem; font-weight:700; box-sizing:border-box;">
                                    <span style="font-size:0.75rem; color:#666;">pt/CRNY</span>
                                </div>
                            </div>
                            <div style="background:linear-gradient(135deg,#fce4ec,#f8bbd0); padding:1rem; border-radius:10px; border:1px solid #f48fb1;">
                                <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem;">
                                    <span style="font-size:1.2rem;">🎭</span>
                                    <strong style="font-size:0.9rem;">CRAC</strong>
                                    <span style="font-size:0.7rem; color:#c2185b;">엔터테인먼트</span>
                                </div>
                                <div style="display:flex; gap:0.4rem; align-items:center;">
                                    <input type="number" id="rate-crac" value="100" min="1" max="10000" style="flex:1; padding:0.6rem; border:1px solid #f48fb1; border-radius:6px; font-size:1rem; font-weight:700; box-sizing:border-box;">
                                    <span style="font-size:0.75rem; color:#666;">pt/CRNY</span>
                                </div>
                            </div>
                            <div style="background:linear-gradient(135deg,#e0f2f1,#b2dfdb); padding:1rem; border-radius:10px; border:1px solid #80cbc4;">
                                <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem;">
                                    <span style="font-size:1.2rem;">🛒</span>
                                    <strong style="font-size:0.9rem;">CRGC</strong>
                                    <span style="font-size:0.7rem; color:#00695c;">커머스</span>
                                </div>
                                <div style="display:flex; gap:0.4rem; align-items:center;">
                                    <input type="number" id="rate-crgc" value="100" min="1" max="10000" style="flex:1; padding:0.6rem; border:1px solid #80cbc4; border-radius:6px; font-size:1rem; font-weight:700; box-sizing:border-box;">
                                    <span style="font-size:0.75rem; color:#666;">pt/CRNY</span>
                                </div>
                            </div>
                            <div style="background:linear-gradient(135deg,#e8f5e9,#c8e6c9); padding:1rem; border-radius:10px; border:1px solid #81c784;">
                                <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem;">
                                    <span style="font-size:1.2rem;">🌱</span>
                                    <strong style="font-size:0.9rem;">CREB</strong>
                                    <span style="font-size:0.7rem; color:#2e7d32;">에코·바이오</span>
                                </div>
                                <div style="display:flex; gap:0.4rem; align-items:center;">
                                    <input type="number" id="rate-creb" value="100" min="1" max="10000" style="flex:1; padding:0.6rem; border:1px solid #81c784; border-radius:6px; font-size:1rem; font-weight:700; box-sizing:border-box;">
                                    <span style="font-size:0.75rem; color:#666;">pt/CRNY</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom:1rem;">
                            <label style="font-size:0.8rem; color:#666; display:block; margin-bottom:0.3rem;">📝 변경 사유 (필수)</label>
                            <input type="text" id="rate-change-reason" placeholder="비율 변경 사유를 입력하세요" style="width:100%; padding:0.7rem; border:1px solid #ddd; border-radius:8px; font-size:0.9rem; box-sizing:border-box;">
                        </div>
                        
                        <button onclick="requestRateChange()" style="width:100%; background:#ff5722; color:white; border:none; padding:0.9rem; border-radius:8px; cursor:pointer; font-weight:700; font-size:1rem;">⚖️ 비율 변경</button>
                        
                        <h4 style="margin:1.5rem 0 0.8rem;">📜 변경 이력</h4>
                        <div id="admin-rate-history" style="max-height:300px; overflow-y:auto;">
                            변경 이력이 없습니다
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB 6: 📋 관리자 로그 (레벨 3+)           -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-log" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">📋 관리자 활동 로그</h3>
                        <button onclick="loadAdminLog()" class="btn-primary" style="margin-bottom:1rem;">🔄 로그 새로고침</button>
                        <div id="admin-log-list"></div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════ -->
                <!-- TAB: 📈 대시보드 통계 (레벨 3+)           -->
                <!-- ═══════════════════════════════════════════ -->
                <div id="admin-tab-dashboard" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                            <h3 style="margin:0;">📈 대시보드 통계</h3>
                            <div style="display:flex; gap:0.5rem; align-items:center;">
                                <span id="dashboard-cache-info" style="font-size:0.7rem; color:#999;"></span>
                                <button onclick="loadAdminDashboardStats(true)" style="background:#1565c0; color:white; border:none; padding:0.4rem 0.8rem; border-radius:6px; cursor:pointer; font-size:0.8rem;">🔄 새로고침</button>
                            </div>
                        </div>

                        <!-- 사용자 통계 -->
                        <div style="margin-bottom:1.5rem;">
                            <h4 style="font-size:0.9rem; margin-bottom:0.6rem;">👥 사용자 통계</h4>
                            <div id="dash-user-stats" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:0.6rem;">
                                <div style="background:#e3f2fd; padding:1rem; border-radius:10px; text-align:center;">
                                    <div style="font-size:0.75rem; color:#1565c0;">총 사용자</div>
                                    <div id="dash-total-users" style="font-size:1.8rem; font-weight:800; color:#0d47a1;">-</div>
                                </div>
                                <div style="background:#e8f5e9; padding:1rem; border-radius:10px; text-align:center;">
                                    <div style="font-size:0.75rem; color:#2e7d32;">오늘 가입</div>
                                    <div id="dash-today-users" style="font-size:1.8rem; font-weight:800; color:#1b5e20;">-</div>
                                </div>
                                <div style="background:#fff3e0; padding:1rem; border-radius:10px; text-align:center;">
                                    <div style="font-size:0.75rem; color:#e65100;">이번 주 가입</div>
                                    <div id="dash-week-users" style="font-size:1.8rem; font-weight:800; color:#bf360c;">-</div>
                                </div>
                            </div>
                        </div>

                        <!-- 거래 통계 -->
                        <div style="margin-bottom:1.5rem;">
                            <h4 style="font-size:0.9rem; margin-bottom:0.6rem;">💰 거래 통계</h4>
                            <div id="dash-tx-stats" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:0.6rem;">
                                <div style="background:#f3e5f5; padding:1rem; border-radius:10px; text-align:center;">
                                    <div style="font-size:0.75rem; color:#7b1fa2;">총 거래</div>
                                    <div id="dash-total-tx" style="font-size:1.8rem; font-weight:800; color:#4a148c;">-</div>
                                </div>
                                <div style="background:#fce4ec; padding:1rem; border-radius:10px; text-align:center;">
                                    <div style="font-size:0.75rem; color:#c2185b;">오늘 거래</div>
                                    <div id="dash-today-tx" style="font-size:1.8rem; font-weight:800; color:#880e4f;">-</div>
                                </div>
                            </div>
                            <div id="dash-tx-by-token" style="margin-top:0.6rem; display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:0.4rem;"></div>
                        </div>

                        <!-- 섹션별 통계 -->
                        <div style="margin-bottom:1.5rem;">
                            <h4 style="font-size:0.9rem; margin-bottom:0.6rem;">📊 섹션별 통계</h4>
                            <div id="dash-section-stats" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:0.8rem;"></div>
                        </div>

                        <!-- 차트: 최근 7일 가입자 -->
                        <div style="margin-bottom:1.5rem;">
                            <h4 style="font-size:0.9rem; margin-bottom:0.6rem;">📅 최근 7일 가입자</h4>
                            <div id="dash-chart-signups" style="display:flex; align-items:flex-end; gap:4px; height:150px; padding:0.5rem; background:#f9f9f9; border-radius:10px;"></div>
                        </div>

                        <!-- 차트: 토큰별 거래량 -->
                        <div>
                            <h4 style="font-size:0.9rem; margin-bottom:0.6rem;">🪙 토큰별 거래량</h4>
                            <div id="dash-chart-tokens" style="display:flex; align-items:flex-end; gap:8px; height:150px; padding:0.5rem; background:#f9f9f9; border-radius:10px;"></div>
                        </div>
                    </div>
                </div>

                <!-- 🏦 슈퍼관리자 계좌 관리 탭 -->
                <div id="admin-tab-superwall" class="admin-tab-content" style="display:none;">
                    <!-- Content rendered dynamically by loadSuperAdminWallets() -->
                </div>

                <!-- 상품 승인/신고 관리 탭 -->
                <div id="admin-tab-products" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">📦 상품 승인 관리</h3>
                        <div id="admin-pending-products">로딩...</div>
                    </div>
                    <div style="background:white; padding:1.5rem; border-radius:12px;">
                        <h3 style="margin-bottom:1rem;">🚨 신고 관리</h3>
                        <div id="admin-reports-list">로딩...</div>
                    </div>
                </div>

                <!-- 쿠폰 관리 탭 -->
                <div id="admin-tab-coupon" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">🎟️ 쿠폰 관리</h3>
                        <div style="display:grid; gap:0.8rem;">
                            <input type="text" id="coupon-name" placeholder="쿠폰 이름 (예: 크라우니트레이딩 챌린지 기념 쿠폰 2026)" style="padding:0.6rem; border:1px solid #ddd; border-radius:6px;">
                            <div style="display:flex; gap:0.5rem;">
                                <input type="text" id="coupon-code" placeholder="쿠폰 코드 (영문/숫자)" style="flex:1; padding:0.6rem; border:1px solid #ddd; border-radius:6px; text-transform:uppercase; font-family:monospace;">
                                <select id="coupon-token" style="padding:0.6rem; border:1px solid #ddd; border-radius:6px;">
                                    <option value="crtd">CRTD</option>
                                    <option value="crac">CRAC</option>
                                    <option value="crgc">CRGC</option>
                                    <option value="creb">CREB</option>
                                </select>
                            </div>
                            <div style="display:flex; gap:0.5rem;">
                                <input type="number" id="coupon-amount" placeholder="지급 수량" style="flex:1; padding:0.6rem; border:1px solid #ddd; border-radius:6px;">
                                <input type="number" id="coupon-max-uses" placeholder="최대 사용 (0=무제한)" value="0" style="flex:1; padding:0.6rem; border:1px solid #ddd; border-radius:6px;">
                            </div>
                            <div style="display:flex; gap:0.5rem;">
                                <input type="datetime-local" id="coupon-expiry" style="flex:1; padding:0.6rem; border:1px solid #ddd; border-radius:6px;">
                                <input type="text" id="coupon-desc" placeholder="설명 (선택)" style="flex:1; padding:0.6rem; border:1px solid #ddd; border-radius:6px;">
                            </div>
                            <button onclick="createCoupon()" class="btn-primary">🎟️ 쿠폰 생성</button>
                        </div>
                    </div>
                    <div style="background:white; padding:1.5rem; border-radius:12px; margin-bottom:1rem;">
                        <h3 style="margin-bottom:1rem;">📋 쿠폰 목록</h3>
                        <button onclick="loadCouponList()" class="btn-primary" style="margin-bottom:1rem;">🔄 새로고침</button>
                        <div id="coupon-list"></div>
                    </div>
                    <div id="coupon-log-section" style="display:none; background:white; padding:1.5rem; border-radius:12px;">
                        <h3 style="margin-bottom:1rem;">📜 쿠폰 사용 로그</h3>
                        <div id="coupon-log-list"></div>
                        <button onclick="closeCouponLog()" class="btn-primary" style="margin-top:0.5rem; background:#999;">닫기</button>
                    </div>
                </div>

                <!-- AI Settings Tab -->
                <div id="admin-tab-rewards" class="admin-tab-content" style="display:none;">
                    <!-- 리워드 설정 — JS에서 동적 렌더링 (loadRewardSettingsTab) -->
                </div>

                <div id="admin-tab-ai" class="admin-tab-content" style="display:none;">
                    <div style="background:white; padding:1.5rem; border-radius:12px;">
                        <h3 style="margin-bottom:1rem;">👑 크라우니 패널 설정</h3>
                        <div style="display:grid; gap:1rem;">
                            <label style="display:flex; align-items:center; gap:0.5rem; font-weight:600;">
                                <input type="checkbox" id="ai-admin-toggle" checked> AI 도우미 활성화
                            </label>
                            <div>
                                <label style="font-weight:600; display:block; margin-bottom:0.3rem;">Gemini API 키</label>
                                <input type="password" id="ai-admin-apikey" placeholder="Google AI Studio API Key" style="width:100%; padding:0.6rem; border:1px solid #ddd; border-radius:6px; box-sizing:border-box; font-family:monospace;">
                                <small style="color:#888;">Google AI Studio에서 무료 API 키를 발급받으세요</small>
                            </div>
                            <div>
                                <label style="font-weight:600; display:block; margin-bottom:0.3rem;">시스템 프롬프트</label>
                                <textarea id="ai-admin-prompt" rows="8" style="width:100%; padding:0.6rem; border:1px solid #ddd; border-radius:6px; box-sizing:border-box; font-size:0.85rem; resize:vertical;"></textarea>
                            </div>
                            <button onclick="AI_ASSISTANT.saveAdminSettings()" class="btn-primary">💾 설정 저장</button>
                        </div>
                    </div>
                </div>

            </div>
        
            </div>
        </main>
    </div>

    <!-- Toast -->
    <div id="toast-container" style="position:fixed;top:20px;right:20px;z-index:99999;display:flex;flex-direction:column;gap:8px;pointer-events:none;"></div>
    <div id="loading-overlay" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:99998;align-items:center;justify-content:center;">
        <div style="background:white;padding:2rem;border-radius:12px;text-align:center;">
            <div style="width:40px;height:40px;border:4px solid #ddd;border-top:4px solid #0066cc;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem;"></div>
            <p id="loading-text">처리 중...</p>
        </div>
    </div>
    <div id="confirm-modal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:99997;align-items:center;justify-content:center;padding:1rem;">
        <div style="background:white;padding:1.5rem;border-radius:12px;max-width:400px;width:100%;">
            <h3 id="confirm-title"></h3>
            <p id="confirm-message" style="color:#666;margin:0.8rem 0 1.2rem;white-space:pre-line;"></p>
            <div style="display:flex;gap:0.5rem;">
                <button id="confirm-cancel" onclick="closeConfirmModal(false)" style="flex:1;padding:0.7rem;border:1px solid #ddd;border-radius:8px;cursor:pointer;background:white;">취소</button>
                <button id="confirm-ok" onclick="closeConfirmModal(true)" style="flex:1;padding:0.7rem;border:none;border-radius:8px;cursor:pointer;background:#0066cc;color:white;font-weight:700;">확인</button>
            </div>
        </div>
    </div>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes slideIn { from { transform: translateX(100%); opacity:0; } to { transform: translateX(0); opacity:1; } }
        @keyframes fadeOut { from { opacity:1; } to { opacity:0; transform:translateY(-10px); } }
        .toast { pointer-events:auto; padding:0.8rem 1.2rem; border-radius:8px; color:white; font-size:0.9rem; box-shadow:0 4px 12px rgba(0,0,0,0.15); animation: slideIn 0.3s ease; max-width:350px; }
        .toast.success { background:#4CAF50; } .toast.error { background:#f44336; } .toast.info { background:#2196F3; } .toast.warning { background:#ff9800; }
        .toast.fadeout { animation: fadeOut 0.3s ease forwards; }
    </style>
    <script>
    function showToast(msg, type='info', dur=3000) { const c=document.getElementById('toast-container'); const t=document.createElement('div'); t.className='toast '+type; t.textContent=msg; c.appendChild(t); setTimeout(()=>{t.classList.add('fadeout'); setTimeout(()=>t.remove(),300);}, dur); }
    function showLoading(t='처리 중...') { document.getElementById('loading-text').textContent=t; document.getElementById('loading-overlay').style.display='flex'; }
    function hideLoading() { document.getElementById('loading-overlay').style.display='none'; }
    let _confirmResolve=null;
    function showConfirmModal(title, message) { return new Promise(r=>{_confirmResolve=r; document.getElementById('confirm-title').textContent=title; document.getElementById('confirm-message').textContent=message; document.getElementById('confirm-modal').style.display='flex';}); }
    function closeConfirmModal(result) { document.getElementById('confirm-modal').style.display='none'; if(_confirmResolve){_confirmResolve(result);_confirmResolve=null;} }
    function showPromptModal(title, message, defaultValue) {
        return new Promise(resolve => {
            const o = document.createElement('div');
            o.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:99997;display:flex;align-items:center;justify-content:center;padding:1rem;';
            o.innerHTML=`<div style="background:white;padding:1.5rem;border-radius:12px;max-width:400px;width:100%;"><h3>${title}</h3><p style="color:#666;margin:0.5rem 0;white-space:pre-line;font-size:0.9rem;">${message}</p><input type="text" id="prompt-input" value="${defaultValue||''}" style="width:100%;padding:0.7rem;border:1px solid #ddd;border-radius:8px;font-size:1rem;box-sizing:border-box;margin:0.5rem 0;"><div style="display:flex;gap:0.5rem;"><button id="p-cancel" style="flex:1;padding:0.7rem;border:1px solid #ddd;border-radius:8px;cursor:pointer;background:white;">취소</button><button id="p-ok" style="flex:1;padding:0.7rem;border:none;border-radius:8px;cursor:pointer;background:#1a1a2e;color:white;font-weight:700;">확인</button></div></div>`;
            document.body.appendChild(o);
            const i=o.querySelector('#prompt-input'); i.focus(); i.select();
            i.onkeydown=e=>{if(e.key==='Enter'){o.remove();resolve(i.value);}if(e.key==='Escape'){o.remove();resolve(null);}};
            o.querySelector('#p-cancel').onclick=()=>{o.remove();resolve(null);};
            o.querySelector('#p-ok').onclick=()=>{o.remove();resolve(i.value);};
        });
    }
    </script>
    <script src="js/i18n.js?v=21.2"></script>
    <script src="js/config.js?v=21.2"></script>
    <script src="js/offchain.js?v=21.2"></script>
    <script src="js/ai-assistant.js?v=21.2"></script>
    <script src="js/admin.js?v=21.2"></script>
    <script>
    // showToast polyfill for admin.html
    if (typeof showToast === 'undefined') {
        function showToast(msg, type, dur) {
            const d = document.createElement('div');
            d.textContent = msg;
            d.style.cssText = 'position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);padding:0.8rem 1.5rem;border-radius:8px;z-index:99999;color:#fff;font-size:0.9rem;background:' + (type==='error'?'#c0392b':type==='warning'?'#e67e22':'#2ecc71');
            document.body.appendChild(d);
            setTimeout(() => d.remove(), dur || 3000);
        }
    }
    </script>
    <script>
    // Admin page auth - redirect if not admin
    let web3;
    try { web3 = new Web3('https://polygon-rpc.com'); } catch(e) { web3 = new Web3('https://rpc-mainnet.matic.quiknode.pro'); }
    
    auth.onAuthStateChanged(async (user) => {
        if (!user) { location.href = 'index.html'; return; }
        currentUser = user;
        document.getElementById('admin-user-email').textContent = user.email;
        await loadUserLevel();
        if (typeof loadTokenRegistry === 'function') await loadTokenRegistry();
        if (typeof loadExchangeRate === 'function') await loadExchangeRate();
        
        if (currentUserLevel < 1) {
            document.getElementById('admin-loading').innerHTML = '<h2>⛔ 권한 없음</h2><p>관리자 권한이 필요합니다.</p><a href="index.html">← 메인으로</a>';
            return;
        }
        document.getElementById('admin-loading').style.display = 'none';
        document.getElementById('admin-content').style.display = 'block';
        document.getElementById('admin-not-authorized').style.display = 'none';
        document.getElementById('admin-panel').style.display = 'block';
        
        // Build sidebar nav
        const nav = document.getElementById('admin-sidebar-nav');
        if (typeof ADMIN_TAB_CONFIG !== 'undefined') {
            ADMIN_TAB_CONFIG.filter(t => hasLevel(t.minLevel)).forEach(t => {
                const a = document.createElement('a');
                a.className = 'nav-link';
                a.href = '#';
                a.textContent = t.icon + ' ' + t.label;
                a.onclick = (e) => { e.preventDefault(); switchAdminTab(t.id); nav.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active')); a.classList.add('active'); };
                nav.appendChild(a);
            });
        }
        
        initAdminPage();
    });
    </script>
</body>
</html>
